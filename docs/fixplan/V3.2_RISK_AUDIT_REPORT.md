# ğŸ” v3.2 ë¦¬íŒ©í† ë§ ìœ„í—˜ ì§€ì  ì „ìˆ˜ ê²€ìƒ‰ ë³´ê³ ì„œ

**ì‘ì—… ì¼ì‹œ:** 2026-01-27  
**ë²„ì „:** v3.2 (Refactored)  
**ëª©ì :** ìì—°ì–´ ëŒ€í™” ë ˆì´ì–´ â†” ì‹œìŠ¤í…œ ìš´ì˜ ë ˆì´ì–´ í˜¼ì¬ ì§€ì  ì „ìˆ˜ ë°œê²¬ ë° ê²©ë¦¬

---

## ğŸ“‹ **A. ë°œê²¬ ë¦¬ìŠ¤íŠ¸ (í‚¤ì›Œë“œë³„)**

### **A1) 1ìˆœìœ„: ìë™ ì‹¤í–‰/ë²„íŠ¼/ì“°ê¸° íŠ¸ë¦¬ê±° (Critical)**

#### **í‚¤ì›Œë“œ: `READY_TO_START`**
| íŒŒì¼ | ë¼ì¸ | ìœ„í—˜ë„ | ìš”ì•½ |
|------|------|--------|------|
| `app/services/response_builder.py` | L200 | âœ… **ì•ˆì „** | v3.2ì—ì„œ FUNCTION_WRITE + Gate Openì¼ ë•Œë§Œ ì¶œë ¥ |
| `app/services/response_builder.py` | L238-239 | âœ… **ì•ˆì „** | ìë™ ë¶€ì°© ì œê±° ì •ê·œì‹ (Gate Closed ì‹œ ì œê±°) |
| `app/services/master_agent_service.py` | L716-718 | âš ï¸ **ì¤‘ìœ„í—˜** | ê¸°ì¡´ v2.2 ì½”ë“œ (response_builderì—ì„œ ì œê±°ë˜ì§€ë§Œ, ì´ì¤‘ ì•ˆì „ì¥ì¹˜) |
| `app/services/master_agent_service.py` | L940-942, L1056-1058, L1157 | ğŸ”´ **ê³ ìœ„í—˜** | **stream_message ë‚´ë¶€ì—ì„œ ì§ì ‘ READY_TO_START JSON ìƒì„±** |
| `tests/test_v32_refactor.py` | L188 | âœ… **ì•ˆì „** | í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ (ì •ìƒ) |

**ìœ„í—˜ ì§€ì :**
- `master_agent_service.py` L940-942, L1056-1058, L1157: **stream_message ë‚´ë¶€ì—ì„œ ì§ì ‘ READY_TO_START JSON ìƒì„±** âŒ
  - **ì¡°ì¹˜ í•„ìš”:** ì´ ë¡œì§ì„ ì œê±°í•˜ê³ , response_builderë¡œ ì´ê´€

---

#### **í‚¤ì›Œë“œ: `MISSION READINESS REPORT`**
| íŒŒì¼ | ë¼ì¸ | ìœ„í—˜ë„ | ìš”ì•½ |
|------|------|--------|------|
| `app/services/response_builder.py` | L234-235 | âœ… **ì•ˆì „** | ìë™ ë¶€ì°© ì œê±° ì •ê·œì‹ |
| `app/services/master_agent_service.py` | L712-713 | âœ… **ì•ˆì „** | ê¸°ì¡´ v2.2 ì œê±° ë¡œì§ (ì´ì¤‘ ì•ˆì „ì¥ì¹˜) |
| `app/services/master_agent_service.py` | L949, L1165, L1173-1174 | ğŸ”´ **ê³ ìœ„í—˜** | **stream_message ë‚´ë¶€ì—ì„œ ì§ì ‘ ìƒì„± í›„ ì œê±°** |

**ìœ„í—˜ ì§€ì :**
- `master_agent_service.py` L949, L1165: **"ì„¤ì • ë¯¸ë¹„" íŒì • ë¬¸êµ¬ë¥¼ stream_message ë‚´ë¶€ì—ì„œ ì§ì ‘ ìƒì„±** âŒ
  - **ì¡°ì¹˜ í•„ìš”:** FUNCTION_WRITE Gate ë¡œì§ìœ¼ë¡œ ëŒ€ì²´

---

#### **í‚¤ì›Œë“œ: `START TASK` / `start_task`**
| íŒŒì¼ | ë¼ì¸ | ìœ„í—˜ë„ | ìš”ì•½ |
|------|------|--------|------|
| `app/services/intent_router.py` | L12 | âœ… **ì•ˆì „** | CONFIRM_TOKENS ì •ì˜ |
| `app/services/response_builder.py` | L105, L199 | âœ… **ì•ˆì „** | v3.2 ì‘ë‹µ ë¡œì§ |
| `app/services/master_agent_service.py` | L276, L339-340, L627, L936, L1052 | âš ï¸ **ì¤‘ìœ„í—˜** | ê¸°ì¡´ v2.2 ì½”ë“œ (v3.2ë¡œ ëŒ€ì²´ í•„ìš”) |
| `app/api/v1/master.py` | L94 | âœ… **ì•ˆì „** | API ì—”ë“œí¬ì¸íŠ¸ (ì •ìƒ) |

---

#### **í‚¤ì›Œë“œ: `execute_project`**
| íŒŒì¼ | ë¼ì¸ | ìœ„í—˜ë„ | ìš”ì•½ |
|------|------|--------|------|
| `app/services/master_agent_service.py` | L109-111, L1097, L1117, L1125 | âœ… **ì•ˆì „** | Tool ì •ì˜ ë° í˜¸ì¶œ (EXECUTOR ì˜ì—­) |
| `app/api/v1/projects.py` | L283 | âœ… **ì•ˆì „** | API ì—”ë“œí¬ì¸íŠ¸ (ì •ìƒ) |

**ë¶„ì„:** execute_projectëŠ” EXECUTOR ë ˆì´ì–´ì—ì„œë§Œ í˜¸ì¶œë˜ë¯€ë¡œ ì•ˆì „ âœ…

---

### **A2) 2ìˆœìœ„: "ì„¤ì • ë¯¸ë¹„/ëˆ„ë½ í•­ëª©" ìë™ ì•ˆë‚´ (High)**

#### **í‚¤ì›Œë“œ: `ì„¤ì • ë¯¸ë¹„` / `ëˆ„ë½ í•­ëª©` / `ë¯¸ë¹„ í•­ëª©`**
| íŒŒì¼ | ë¼ì¸ | ìœ„í—˜ë„ | ìš”ì•½ |
|------|------|--------|------|
| `app/services/mes_sync.py` | L20 | âœ… **ì•ˆì „** | ì£¼ì„ - "ì„¤ì • ë¯¸ë¹„ íŒë‹¨ ë¬¸êµ¬ ê¸ˆì§€" ëª…ì‹œ |
| `app/services/master_agent_service.py` | L958 | ğŸ”´ **ê³ ìœ„í—˜** | **"ë¯¸ë¹„ í•­ëª© ë³´ê°•í•´ì¤˜" ë©”ë‰´ ìë™ ì¶œë ¥** âŒ |
| `app/services/master_agent_service.py` | L1010 | ğŸ”´ **ê³ ìœ„í—˜** | **"ëˆ„ë½ í•­ëª© ìë™ ë³´ê°•" ë¡œì§** âŒ |
| `app/services/master_agent_service.py` | L1164-1165 | ğŸ”´ **ê³ ìœ„í—˜** | **"ì„¤ì • ë¯¸ë¹„ë¡œ í™•ì •í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤" ìë™ ìƒì„±** âŒ |

**ìœ„í—˜ ì§€ì :**
- `master_agent_service.py` L958: **UNCLEAR intent ì‹œ ëª…ë ¹ì–´ ë©”ë‰´ ìë™ ì¶œë ¥** âŒ
  - **ì¡°ì¹˜ í•„ìš”:** NATURAL intentëŠ” ìì—°ì–´ ì‘ë‹µë§Œ, ë©”ë‰´ ê°•ì œ ì¶œë ¥ ê¸ˆì§€
- `master_agent_service.py` L1010: **CONFIG_CHANGE intentì—ì„œ ìë™ ë³´ê°• ë¡œì§** âŒ
  - **ì¡°ì¹˜ í•„ìš”:** FUNCTION_WRITE + Gate Openì—ì„œë§Œ í—ˆìš©
- `master_agent_service.py` L1164-1165: **EXECUTION_REQUESTì—ì„œ ì„¤ì • ë¯¸ë¹„ íŒì •** âŒ
  - **ì¡°ì¹˜ í•„ìš”:** FUNCTION_WRITE Gateë¡œ ëŒ€ì²´

---

#### **í‚¤ì›Œë“œ: `ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤` / `ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤` / `í™•ì •`**
| íŒŒì¼ | ë¼ì¸ | ìœ„í—˜ë„ | ìš”ì•½ |
|------|------|--------|------|
| `app/services/intent_router.py` | L12 | âœ… **ì•ˆì „** | CONFIRM_TOKENS ì •ì˜ |
| `app/services/response_builder.py` | L71, L87, L96, L105 | âœ… **ì•ˆì „** | v3.2 Gate Closed ì•ˆë‚´ ë¬¸êµ¬ |
| `app/services/master_agent_service.py` | L276, L855, L1001, L1052, L1070, L1146-1147 | âš ï¸ **ì¤‘ìœ„í—˜** | ê¸°ì¡´ v2.2 ì½”ë“œ (v3.2ë¡œ ëŒ€ì²´ í•„ìš”) |

**ë¶„ì„:** v3.2 response_builderì—ì„œëŠ” ì•ˆì „í•˜ê²Œ ì²˜ë¦¬ë¨ âœ…  
**ë‹¨, master_agent_service.pyì˜ ê¸°ì¡´ v2.2 ë¡œì§ì€ ì œê±° í•„ìš”** âš ï¸

---

### **A3) 3ìˆœìœ„: ì—ì´ì „íŠ¸ êµ¬ì„± ë³€ê²½/DB ì—…ë°ì´íŠ¸ (High)**

#### **í‚¤ì›Œë“œ: `update_agent_config_tool` / `add_agent_tool`**
| íŒŒì¼ | ë¼ì¸ | ìœ„í—˜ë„ | ìš”ì•½ |
|------|------|--------|------|
| `app/services/master_agent_service.py` | L122-143, L207-273 | âœ… **ì•ˆì „** | Tool ì •ì˜ (ì •ìƒ) |
| `app/services/master_agent_service.py` | L1035-1036, L1081, L1097, L1117, L1127-1128 | ğŸ”´ **ê³ ìœ„í—˜** | **stream_message ë‚´ë¶€ì—ì„œ ì§ì ‘ Tool í˜¸ì¶œ** âŒ |

**ìœ„í—˜ ì§€ì :**
- `master_agent_service.py` L1035-1036: **CONFIG_CHANGE intentì—ì„œ update_agent_config_tool ì§ì ‘ í˜¸ì¶œ** âŒ
  - **ì¡°ì¹˜ í•„ìš”:** FUNCTION_WRITE + Gate Openì—ì„œë§Œ í—ˆìš©, stream_messageì—ì„œëŠ” ì œê±°
- `master_agent_service.py` L1081: **ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ì— "ì§ˆë¬¸í•˜ì§€ ë§ê³  ì¦‰ì‹œ update_agent_config_toolë¡œ DB ì—…ë°ì´íŠ¸" ì§€ì‹œ** âŒ
  - **ì¡°ì¹˜ í•„ìš”:** ì´ ì§€ì‹œë¬¸ ì œê±°, v3.2 ì² í•™ê³¼ ì¶©ëŒ

---

#### **í‚¤ì›Œë“œ: `neo4j` / `rag` / `retrieval`**
| íŒŒì¼ | ë¼ì¸ | ìœ„í—˜ë„ | ìš”ì•½ |
|------|------|--------|------|
| `app/services/mes_sync.py` | L22, L28 | âœ… **ì•ˆì „** | ì‹¤ì‹œê°„ DB ì¡°íšŒ (FUNCTION_READ í—ˆìš©) |
| `app/services/master_agent_service.py` | L25, L32, L55, L63, L117, L126, L138, L150, L181, L210, L273, L443, L636 | âœ… **ì•ˆì „** | Tool ì •ì˜ ë° ì‹¤ì‹œê°„ ì¡°íšŒ |
| `app/services/master_agent_service.py` | L875 | âœ… **ì•ˆì „** | "RAG ì˜¤ì—¼ ì°¨ë‹¨" ì£¼ì„ ëª…ì‹œ |

**ë¶„ì„:** neo4j ì‚¬ìš©ì€ ëª¨ë‘ ì‹¤ì‹œê°„ DB ì¡°íšŒì´ë¯€ë¡œ ì•ˆì „ âœ…  
**RAG/Vector ê²€ìƒ‰ ì‚¬ìš© í™•ì¸ í•„ìš”** â†’ ê²€ìƒ‰ ê²°ê³¼ ì—†ìŒ, ì•ˆì „ âœ…

---

### **A4) 4ìˆœìœ„: ì‘ë‹µ ì¡°ë¦½/í›„ì²˜ë¦¬ (Medium)**

#### **í‚¤ì›Œë“œ: `response_builder` / `final_response`**
| íŒŒì¼ | ë¼ì¸ | ìœ„í—˜ë„ | ìš”ì•½ |
|------|------|--------|------|
| `app/services/response_builder.py` | ì „ì²´ | âœ… **ì•ˆì „** | v3.2 ë¦¬íŒ©í† ë§ ì™„ë£Œ |
| `app/services/v32_stream_message_refactored.py` | L17, L82, L88 | âœ… **ì•ˆì „** | v3.2 ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜ |
| `app/models/stream_context.py` | L57 | âœ… **ì•ˆì „** | StreamContext ì •ì˜ |
| `tests/test_v32_refactor.py` | ì „ì²´ | âœ… **ì•ˆì „** | í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ |

**ë¶„ì„:** v3.2 response_builderëŠ” ì™„ì „íˆ ê²©ë¦¬ë¨ âœ…

---

#### **í‚¤ì›Œë“œ: `re.DOTALL` / `re.sub`**
| íŒŒì¼ | ë¼ì¸ | ìœ„í—˜ë„ | ìš”ì•½ |
|------|------|--------|------|
| `app/services/response_builder.py` | L247 | âœ… **ì•ˆì „** | ìë™ ë¶€ì°© ì œê±° ì •ê·œì‹ (v3.2) |

**ë¶„ì„:** ì •ê·œì‹ ì‚¬ìš©ì€ ì•ˆì „í•˜ê²Œ ì œí•œë¨ âœ…

---

## ğŸš¨ **B. êµì²´ í¬ì¸íŠ¸ ì²´í¬ë¦¬ìŠ¤íŠ¸ (ìœ„í—˜ë„ë³„ ìš°ì„ ìˆœìœ„)**

### **B1) Critical (ì¦‰ì‹œ ìˆ˜ìˆ ) - 5ê°œ ë°œê²¬**

#### **âŒ Critical #1: stream_message ë‚´ë¶€ì—ì„œ ì§ì ‘ READY_TO_START JSON ìƒì„±**
- **íŒŒì¼:** `app/services/master_agent_service.py`
- **ë¼ì¸:** L940-942, L1056-1058, L1157
- **í˜„ì¬ ì½”ë“œ:**
  ```python
  # L940-942
  report = f"\n\nâœ… [ì¤€ë¹„ ìƒíƒœ ì ê²€ ì™„ë£Œ]\nëª¨ë“  ì„¤ì •ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ì•„ë˜ [START TASK] ë²„íŠ¼ì„ ëˆŒëŸ¬ ì‘ì—…ì„ ì‹œì‘í•˜ì„¸ìš”.\n\n"
  yield report
  yield json.dumps({"status": "READY_TO_START", "project_id": project_id}, ensure_ascii=False)
  ```
- **ìœ„í—˜ ì´ìœ :** stream_message ë‚´ë¶€ì—ì„œ ì§ì ‘ ë²„íŠ¼ ìƒì„± âŒ
- **ì¡°ì¹˜:** ì´ ë¡œì§ì„ ì œê±°í•˜ê³ , response_builderë¡œ ì´ê´€ (ì´ë¯¸ L199-200ì— êµ¬í˜„ë¨)
- **ìš°ì„ ìˆœìœ„:** ğŸ”´ **ìµœìš°ì„ **

---

#### **âŒ Critical #2: stream_message ë‚´ë¶€ì—ì„œ ì§ì ‘ MISSION READINESS REPORT ìƒì„±**
- **íŒŒì¼:** `app/services/master_agent_service.py`
- **ë¼ì¸:** L949, L1165
- **í˜„ì¬ ì½”ë“œ:**
  ```python
  # L949
  report = f"\n\n--- MISSION READINESS REPORT ---\nâš ï¸ ë‹¤ìŒ í•­ëª©ì´ ë¯¸ë¹„í•©ë‹ˆë‹¤:\n- " + "\n- ".join(check.get('missing', [])[:5])
  
  # L1165
  report = f"\n\n--- MISSION READINESS REPORT ---\nâš ï¸ ì„¤ì • ë¯¸ë¹„ë¡œ í™•ì •í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤:\n- " + "\n- ".join(check.get('missing', [])[:5])
  ```
- **ìœ„í—˜ ì´ìœ :** stream_message ë‚´ë¶€ì—ì„œ ì§ì ‘ ì„¤ì • ë¯¸ë¹„ íŒì • âŒ
- **ì¡°ì¹˜:** FUNCTION_WRITE Gateë¡œ ëŒ€ì²´ (response_builder.py L71-105ì— êµ¬í˜„ë¨)
- **ìš°ì„ ìˆœìœ„:** ğŸ”´ **ìµœìš°ì„ **

---

#### **âŒ Critical #3: "ì‘/ì˜ˆ/ì¢‹ì•„"ì— ë©”ë‰´ ìë™ ì¶œë ¥**
- **íŒŒì¼:** `app/services/master_agent_service.py`
- **ë¼ì¸:** L958
- **í˜„ì¬ ì½”ë“œ:**
  ```python
  simple_msg = "ì‚¬ìš©ìë‹˜, êµ¬ì²´ì ì¸ ì§€ì‹œë¥¼ ì£¼ì‹œë©´ ë°”ë¡œ ì‹¤í–‰í•˜ê² ìŠµë‹ˆë‹¤.\n\në‹¤ìŒ ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤:\nâ€¢ 'ì¤€ë¹„ ìƒíƒœ ì ê²€' - í˜„ì¬ ì„¤ì • í™•ì¸\nâ€¢ 'í˜„ì¬ ì—ì´ì „íŠ¸ êµ¬ì„± ì•Œë ¤ì¤˜' - ìƒì„¸ ì •ë³´ ì¡°íšŒ\nâ€¢ 'ë¯¸ë¹„ í•­ëª© ë³´ê°•í•´ì¤˜' - ìë™ ì„¤ì • ë³´ê°•\nâ€¢ 'ì‹¤í–‰ í™•ì •' - ì‘ì—… ì‹œì‘"
  ```
- **ìœ„í—˜ ì´ìœ :** UNCLEAR intent ì‹œ ìš´ì˜ ë©”ë‰´ ìë™ ì¶œë ¥ âŒ (Cí•­ ê¸ˆì§€ íŒ¨í„´)
- **ì¡°ì¹˜:** NATURAL intentëŠ” ìì—°ì–´ ì‘ë‹µë§Œ, ë©”ë‰´ ê°•ì œ ì¶œë ¥ ê¸ˆì§€
- **ìš°ì„ ìˆœìœ„:** ğŸ”´ **ìµœìš°ì„ **

---

#### **âŒ Critical #4: stream_message ë‚´ë¶€ì—ì„œ update_agent_config_tool ì§ì ‘ í˜¸ì¶œ**
- **íŒŒì¼:** `app/services/master_agent_service.py`
- **ë¼ì¸:** L1035-1036
- **í˜„ì¬ ì½”ë“œ:**
  ```python
  await update_agent_config_tool.ainvoke({
      "project_id": project_id,
      "agent_id": agent_id,
      "updates": updates
  })
  ```
- **ìœ„í—˜ ì´ìœ :** CONFIG_CHANGE intentì—ì„œ stream_message ë‚´ë¶€ì—ì„œ ì§ì ‘ DB ì—…ë°ì´íŠ¸ âŒ
- **ì¡°ì¹˜:** FUNCTION_WRITE + Gate Openì—ì„œë§Œ í—ˆìš©, stream_messageì—ì„œëŠ” ì œê±°
- **ìš°ì„ ìˆœìœ„:** ğŸ”´ **ìµœìš°ì„ **

---

#### **âŒ Critical #5: ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ì— "ì§ˆë¬¸í•˜ì§€ ë§ê³  ì¦‰ì‹œ DB ì—…ë°ì´íŠ¸" ì§€ì‹œ**
- **íŒŒì¼:** `app/services/master_agent_service.py`
- **ë¼ì¸:** L1081
- **í˜„ì¬ ì½”ë“œ:**
  ```python
  3. ì‚¬ìš©ìê°€ ìš”êµ¬ì‚¬í•­ì„ ì¶”ê°€í•˜ë©´ ì§ˆë¬¸í•˜ì§€ ë§ê³  ì¦‰ì‹œ 'update_agent_config_tool'ë¡œ DBë¥¼ ì—…ë°ì´íŠ¸í•œ ë’¤ ë³´ê³ í•˜ì‹­ì‹œì˜¤.
  ```
- **ìœ„í—˜ ì´ìœ :** v3.2 ì² í•™ ("ìì—°ì–´ ììœ  + ê°•ì œ ê²Œì´íŠ¸")ê³¼ ì •ë©´ ì¶©ëŒ âŒ
- **ì¡°ì¹˜:** ì´ ì§€ì‹œë¬¸ ì œê±°, REQUIREMENT intentëŠ” Draft/MESë§Œ ê°±ì‹ 
- **ìš°ì„ ìˆœìœ„:** ğŸ”´ **ìµœìš°ì„ **

---

### **B2) High (ë‹¤ìŒ ìš°ì„ ) - 3ê°œ ë°œê²¬**

#### **âš ï¸ High #1: CONFIG_CHANGE intentì—ì„œ ìë™ ë³´ê°• ë¡œì§**
- **íŒŒì¼:** `app/services/master_agent_service.py`
- **ë¼ì¸:** L1010-1030
- **í˜„ì¬ ì½”ë“œ:**
  ```python
  # ê° ì—ì´ì „íŠ¸ì˜ ëˆ„ë½ í•­ëª© ìë™ ë³´ê°•
  for agent_config in agents:
      # ...
      if role_normalized not in ["REPORTER", "PLANNER"] and not agent_config.get("tool_allowlist"):
          updates["tool_allowlist"] = ["read_file", "write_file", "list_dir"]
  ```
- **ìœ„í—˜ ì´ìœ :** CONFIG_CHANGE intentì—ì„œ ìë™ìœ¼ë¡œ DB ì—…ë°ì´íŠ¸ âŒ
- **ì¡°ì¹˜:** FUNCTION_WRITE + Gate Openì—ì„œë§Œ í—ˆìš©
- **ìš°ì„ ìˆœìœ„:** âš ï¸ **ë†’ìŒ**

---

#### **âš ï¸ High #2: EXECUTION_REQUESTì—ì„œ ì„¤ì • ë¯¸ë¹„ íŒì • í›„ ì•ˆë‚´**
- **íŒŒì¼:** `app/services/master_agent_service.py`
- **ë¼ì¸:** L1164-1166
- **í˜„ì¬ ì½”ë“œ:**
  ```python
  # í•˜ì§€ë§Œ EXECUTION_REQUESTì´ë©´ì„œ ì„¤ì • ë¯¸ë¹„ì¸ ê²½ìš°ëŠ” ë³´ê³ ì„œ ì¶œë ¥
  report = f"\n\n--- MISSION READINESS REPORT ---\nâš ï¸ ì„¤ì • ë¯¸ë¹„ë¡œ í™•ì •í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤:\n- " + "\n- ".join(check.get('missing', [])[:5])
  yield report
  ```
- **ìœ„í—˜ ì´ìœ :** EXECUTION_REQUESTì—ì„œ ì„¤ì • ë¯¸ë¹„ íŒì • âŒ (FUNCTION_WRITE Gateë¡œ ëŒ€ì²´)
- **ì¡°ì¹˜:** ì´ ë¡œì§ ì œê±°, response_builder.pyì˜ Gate Closed ì•ˆë‚´ë¡œ ëŒ€ì²´
- **ìš°ì„ ìˆœìœ„:** âš ï¸ **ë†’ìŒ**

---

#### **âš ï¸ High #3: ê¸°ì¡´ v2.2 ì½”ë“œ ì”ì¡´**
- **íŒŒì¼:** `app/services/master_agent_service.py`
- **ë¼ì¸:** L716-718, L830-1176 (ëŒ€ë¶€ë¶„)
- **ìœ„í—˜ ì´ìœ :** v2.2 ë¡œì§ì´ stream_messageì— ê·¸ëŒ€ë¡œ ë‚¨ì•„ ìˆìŒ âš ï¸
- **ì¡°ì¹˜:** v3.2 stream_message_v32ë¡œ ì™„ì „ êµì²´
- **ìš°ì„ ìˆœìœ„:** âš ï¸ **ë†’ìŒ**

---

### **B3) Medium (ì •ë¦¬ ë‹¨ê³„) - 1ê°œ ë°œê²¬**

#### **âœ… Medium #1: ê³¼ê±° ì—ì´ì „íŠ¸ ì”ìƒ ì–¸ê¸‰**
- **í˜„í™©:** ê²€ìƒ‰ ê²°ê³¼ "CODER", "REVIEWER" ë“± ê³¼ê±° ì—ì´ì „íŠ¸ ì–¸ê¸‰ ì—†ìŒ âœ…
- **ë¶„ì„:** v3.2ì—ì„œ ì‹¤ì‹œê°„ DB ì¡°íšŒë§Œ ì‚¬ìš©í•˜ë¯€ë¡œ ì•ˆì „ âœ…
- **ì¡°ì¹˜:** ì—†ìŒ (ì •ìƒ)

---

## ğŸš« **C. "ì°¾ìœ¼ë©´ ë¬´ì¡°ê±´ ì‹¤íŒ¨" ê¸ˆì§€ íŒ¨í„´ ê²€ì¦**

### **âŒ Pattern #1: ì¸ì‚¬("ì•ˆë…•")ì— ìš´ì˜ ëª…ë ¹ì–´ ë©”ë‰´ ìë™ ë¶€ì°©**
- **íŒŒì¼:** `app/services/master_agent_service.py`
- **ë¼ì¸:** L958
- **ë°œê²¬:** âœ… **ë°œê²¬ë¨**
- **ì¡°ì¹˜:** **ì¦‰ì‹œ ì œê±° í•„ìš”** ğŸ”´

---

### **âŒ Pattern #2: "ì–´ë–»ê²Œ ì§„í–‰í• ê¹Œìš”" + ì„ íƒì§€ ìë™ ì¶œë ¥**
- **ê²€ìƒ‰ ê²°ê³¼:** ëª…ì‹œì  íŒ¨í„´ ì—†ìŒ
- **ë‹¨, L958ì˜ ë©”ë‰´ ì¶œë ¥ì´ ìœ ì‚¬ íŒ¨í„´ì„**
- **ì¡°ì¹˜:** **L958 ì œê±°ë¡œ í•´ê²°** ğŸ”´

---

### **âŒ Pattern #3: "ì„¤ì • ë¯¸ë¹„/í™œì„±í™” ë¶ˆê°€/ì°¨ë‹¨" íŒì • í‘œí˜„ì„ ëŒ€í™” ê·¼ê±°ë¡œ ì‚¬ìš©**
- **íŒŒì¼:** `app/services/master_agent_service.py`
- **ë¼ì¸:** L949, L1165
- **ë°œê²¬:** âœ… **ë°œê²¬ë¨**
- **ì¡°ì¹˜:** **ì¦‰ì‹œ ì œê±° í•„ìš”** ğŸ”´

---

### **âŒ Pattern #4: "Mission Readiness Report"ë¥¼ ì‘ë‹µì— í¬í•¨**
- **íŒŒì¼:** `app/services/master_agent_service.py`
- **ë¼ì¸:** L949, L1165
- **ë°œê²¬:** âœ… **ë°œê²¬ë¨**
- **ì¡°ì¹˜:** **ì¦‰ì‹œ ì œê±° í•„ìš”** ğŸ”´

---

## ğŸ“Š **D. ì¡°ì¹˜ ë¦¬ìŠ¤íŠ¸ (Critical â†’ High â†’ Medium)**

### **Critical ì¡°ì¹˜ (5ê°œ) - ì¦‰ì‹œ ìˆ˜ìˆ **

#### **âœ‚ï¸ Critical ì¡°ì¹˜ #1: stream_message ë‚´ READY_TO_START ìƒì„± ì œê±°**
```python
# âŒ ì œê±° ëŒ€ìƒ (master_agent_service.py L940-942, L1056-1058, L1157)
yield json.dumps({"status": "READY_TO_START", "project_id": project_id}, ensure_ascii=False)

# âœ… ëŒ€ì²´ (response_builder.py L199-200ì— ì´ë¯¸ êµ¬í˜„ë¨)
# FUNCTION_WRITE + Gate Openì¼ ë•Œë§Œ response_builderì—ì„œ ìƒì„±
```

---

#### **âœ‚ï¸ Critical ì¡°ì¹˜ #2: MISSION READINESS REPORT ìƒì„± ì œê±°**
```python
# âŒ ì œê±° ëŒ€ìƒ (master_agent_service.py L949, L1165)
report = f"\n\n--- MISSION READINESS REPORT ---\nâš ï¸ ì„¤ì • ë¯¸ë¹„ë¡œ í™•ì •í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤:\n- " + ...

# âœ… ëŒ€ì²´ (response_builder.py L71-105ì— ì´ë¯¸ êµ¬í˜„ë¨)
# FUNCTION_WRITE Gate Closed ì•ˆë‚´ ë¬¸êµ¬ë¡œ ëŒ€ì²´
```

---

#### **âœ‚ï¸ Critical ì¡°ì¹˜ #3: UNCLEAR intent ë©”ë‰´ ì¶œë ¥ ì œê±°**
```python
# âŒ ì œê±° ëŒ€ìƒ (master_agent_service.py L958)
simple_msg = "ì‚¬ìš©ìë‹˜, êµ¬ì²´ì ì¸ ì§€ì‹œë¥¼ ì£¼ì‹œë©´ ë°”ë¡œ ì‹¤í–‰í•˜ê² ìŠµë‹ˆë‹¤.\n\në‹¤ìŒ ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤:\nâ€¢ 'ì¤€ë¹„ ìƒíƒœ ì ê²€' - í˜„ì¬ ì„¤ì • í™•ì¸\n..."

# âœ… ëŒ€ì²´ (response_builder.pyì— ì´ë¯¸ êµ¬í˜„ë¨)
# NATURAL intentëŠ” ìì—°ì–´ ì‘ë‹µë§Œ (ì˜ˆ: "ë„¤, í˜•ë‹˜!")
```

---

#### **âœ‚ï¸ Critical ì¡°ì¹˜ #4: stream_message ë‚´ update_agent_config_tool í˜¸ì¶œ ì œê±°**
```python
# âŒ ì œê±° ëŒ€ìƒ (master_agent_service.py L1035-1036)
await update_agent_config_tool.ainvoke({"project_id": project_id, "agent_id": agent_id, "updates": updates})

# âœ… ëŒ€ì²´
# FUNCTION_WRITE + Gate Openì—ì„œë§Œ í—ˆìš© (EXECUTOR ë ˆì´ì–´)
```

---

#### **âœ‚ï¸ Critical ì¡°ì¹˜ #5: ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ ì§€ì‹œë¬¸ ìˆ˜ì •**
```python
# âŒ ì œê±° ëŒ€ìƒ (master_agent_service.py L1081)
"3. ì‚¬ìš©ìê°€ ìš”êµ¬ì‚¬í•­ì„ ì¶”ê°€í•˜ë©´ ì§ˆë¬¸í•˜ì§€ ë§ê³  ì¦‰ì‹œ 'update_agent_config_tool'ë¡œ DBë¥¼ ì—…ë°ì´íŠ¸í•œ ë’¤ ë³´ê³ í•˜ì‹­ì‹œì˜¤."

# âœ… ëŒ€ì²´
"3. ì‚¬ìš©ìê°€ ìš”êµ¬ì‚¬í•­ì„ ì¶”ê°€í•˜ë©´ Draft/MESì—ë§Œ ë°˜ì˜í•˜ê³ , ì‹¤ì œ ì‹¤í–‰ì€ 'ì‹¤í–‰ í™•ì •' ì´í›„ì—ë§Œ í—ˆìš©í•˜ì‹­ì‹œì˜¤."
```

---

### **High ì¡°ì¹˜ (3ê°œ) - ë‹¤ìŒ ìš°ì„ **

#### **ğŸ”§ High ì¡°ì¹˜ #1: CONFIG_CHANGE intent ìë™ ë³´ê°• ë¡œì§ ê²©ë¦¬**
```python
# âš ï¸ ìˆ˜ì • ëŒ€ìƒ (master_agent_service.py L1010-1030)
# í˜„ì¬: CONFIG_CHANGE intentì—ì„œ ìë™ ë³´ê°•
# ìˆ˜ì •: FUNCTION_WRITE + Gate Openì—ì„œë§Œ í—ˆìš©
```

---

#### **ğŸ”§ High ì¡°ì¹˜ #2: EXECUTION_REQUEST ì„¤ì • ë¯¸ë¹„ íŒì • ì œê±°**
```python
# âš ï¸ ì œê±° ëŒ€ìƒ (master_agent_service.py L1164-1166)
# í˜„ì¬: EXECUTION_REQUESTì—ì„œ ì„¤ì • ë¯¸ë¹„ íŒì •
# ëŒ€ì²´: response_builderì˜ Gate Closed ì•ˆë‚´ë¡œ ëŒ€ì²´
```

---

#### **ğŸ”§ High ì¡°ì¹˜ #3: ê¸°ì¡´ v2.2 stream_message ì™„ì „ êµì²´**
```python
# âš ï¸ ì¡°ì¹˜
# 1. master_agent_service.pyì˜ ê¸°ì¡´ stream_message â†’ stream_message_v22ë¡œ rename (ë°±ì—…)
# 2. v32_stream_message_refactored.pyë¥¼ stream_messageë¡œ í†µí•©
# 3. ê¸°ì¡´ v2.2 ë¡œì§ ì™„ì „ ì œê±°
```

---

### **Medium ì¡°ì¹˜ (0ê°œ) - ì •ë¦¬ ë‹¨ê³„**
- ì—†ìŒ (ëª¨ë‘ ì•ˆì „) âœ…

---

## ğŸ›¡ï¸ **E. ì¬ë°œ ë°©ì§€ ì¦ëª…**

### **âœ… v3.2 ë¦¬íŒ©í† ë§ ì™„ë£Œ í™•ì¸ (Safe Zone)**

#### **1. stream_message ë‚´ DB write/ë²„íŠ¼ ìƒì„±ì´ "0ê±´"ì„ì„ ì¦ëª…**

**v3.2 ë¦¬íŒ©í† ë§ íŒŒì¼ ê²€ì¦:**
- `app/services/v32_stream_message_refactored.py` (70ì¤„)
  - âœ… DB write: **0ê±´**
  - âœ… ë²„íŠ¼ ìƒì„±: **0ê±´**
  - âœ… update_agent_config_tool í˜¸ì¶œ: **0ê±´**
  - âœ… READY_TO_START ìƒì„±: **0ê±´**
  - âœ… MISSION READINESS REPORT ìƒì„±: **0ê±´**

**ê²€ì¦ ë°©ë²•:**
```bash
# v32_stream_message_refactored.pyì—ì„œ ìœ„í—˜ í‚¤ì›Œë“œ ê²€ìƒ‰
grep -E "(db\.update|db\.commit|redis\.set|neo4j|update_agent_config|READY_TO_START|MISSION READINESS)" \
  backend/app/services/v32_stream_message_refactored.py

# ê²°ê³¼: No matches found âœ…
```

---

#### **2. response_builderì—ì„œ Gate ì¡°ê±´ ê²€ì¦**

**response_builder.py L87-109:**
```python
# [Guardrail ì›ì¹™ 5] 4ì¡°ê±´ AND ê²€ì¦
if ctx.verification_state != "VERIFIED":
    ctx.write_gate_open = False
    return ctx

if ctx.mes_hash != ctx.verified_hash:
    ctx.write_gate_open = False
    return ctx

if not ctx.confirm_token_detected:
    ctx.write_gate_open = False
    return ctx

# ëª¨ë“  ì¡°ê±´ í†µê³¼ â†’ Gate Open
ctx.write_gate_open = True
```

**ì¦ëª…:** FUNCTION_WRITEëŠ” 4ì¡°ê±´ ANDë§Œ í—ˆìš© âœ…

---

#### **3. ìë™ ë¶€ì°© ì œê±° ê²€ì¦**

**response_builder.py L217-247:**
```python
# [Guardrail ì›ì¹™ 6] ìë™ ë¶€ì°© ì œê±°
if ctx.primary_intent != "FUNCTION_WRITE" or not ctx.write_gate_open:
    ctx.final_response = _remove_auto_attachments(ctx.final_response)

def _remove_auto_attachments(content: str) -> str:
    patterns = [
        r"---\s*MISSION READINESS REPORT\s*---[\s\S]*?(?=\n\n|\Z)",
        r'```json\s*\{\s*"status"\s*:\s*"READY_TO_START"[\s\S]*?```',
    ]
    for pattern in patterns:
        content = re.sub(pattern, "", content, flags=re.MULTILINE | re.DOTALL)
    return content.strip()
```

**ì¦ëª…:** intent != FUNCTION_WRITE ë˜ëŠ” Gate Closedë©´ ë¬´ì¡°ê±´ ì œê±° âœ…

---

## ğŸ“‹ **F. ìµœì¢… ìš”ì•½**

### **ë°œê²¬ ì§€ì  ì´ê³„**
| ìœ„í—˜ë„ | ë°œê²¬ ê±´ìˆ˜ | ì¡°ì¹˜ í•„ìš” | ì•ˆì „ | ìƒíƒœ |
|--------|----------|----------|------|------|
| ğŸ”´ **Critical** | 5ê±´ | 5ê±´ | 0ê±´ | âš ï¸ **ì¦‰ì‹œ ì¡°ì¹˜ í•„ìš”** |
| âš ï¸ **High** | 3ê±´ | 3ê±´ | 0ê±´ | âš ï¸ **ë‹¤ìŒ ìš°ì„ ** |
| âœ… **Medium** | 0ê±´ | 0ê±´ | ëª¨ë‘ | âœ… **ì•ˆì „** |
| âœ… **Safe (v3.2)** | ëª¨ë‘ | 0ê±´ | ëª¨ë‘ | âœ… **ì™„ì „ ê²©ë¦¬** |

---

### **Critical ì¡°ì¹˜ ëŒ€ìƒ (5ê±´) - ì¦‰ì‹œ ìˆ˜ìˆ **
1. âŒ stream_message ë‚´ READY_TO_START ìƒì„± (L940-942, L1056-1058, L1157)
2. âŒ stream_message ë‚´ MISSION READINESS REPORT ìƒì„± (L949, L1165)
3. âŒ UNCLEAR intent ë©”ë‰´ ìë™ ì¶œë ¥ (L958)
4. âŒ stream_message ë‚´ update_agent_config_tool í˜¸ì¶œ (L1035-1036)
5. âŒ ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ "ì¦‰ì‹œ DB ì—…ë°ì´íŠ¸" ì§€ì‹œ (L1081)

---

### **High ì¡°ì¹˜ ëŒ€ìƒ (3ê±´) - ë‹¤ìŒ ìš°ì„ **
1. âš ï¸ CONFIG_CHANGE intent ìë™ ë³´ê°• ë¡œì§ (L1010-1030)
2. âš ï¸ EXECUTION_REQUEST ì„¤ì • ë¯¸ë¹„ íŒì • (L1164-1166)
3. âš ï¸ ê¸°ì¡´ v2.2 stream_message ì™„ì „ êµì²´ (L830-1176)

---

### **v3.2 ë¦¬íŒ©í† ë§ ì™„ë£Œ í™•ì¸ âœ…**
- `v32_stream_message_refactored.py`: **DB write 0ê±´, ë²„íŠ¼ ìƒì„± 0ê±´** âœ…
- `response_builder.py`: **4ì¡°ê±´ AND ê°•ì œ, ìë™ ë¶€ì°© ì œê±°** âœ…
- `intent_router.py`: **Primary Intent 1ê°œ + Flags** âœ…
- `mes_sync.py`: **MES ë³€ê²½ ì‹œ VERIFIED í•´ì œ** âœ…

---

## ğŸ¯ **G. ë‹¤ìŒ ë‹¨ê³„ (ë°°í¬ ì „ í•„ìˆ˜)**

### **Step 1: Critical ì¡°ì¹˜ ì™„ë£Œ (5ê±´)**
```bash
# master_agent_service.py ìˆ˜ì •
# L940-942, L1056-1058, L1157, L949, L1165, L958, L1035-1036, L1081 ì œê±°
```

### **Step 2: High ì¡°ì¹˜ ì™„ë£Œ (3ê±´)**
```bash
# L1010-1030, L1164-1166 ìˆ˜ì •
# ê¸°ì¡´ v2.2 stream_message â†’ stream_message_v22ë¡œ ë°±ì—…
```

### **Step 3: v3.2 í†µí•©**
```python
# master_agent_service.pyì—ì„œ
from app.services.v32_stream_message_refactored import stream_message_v32

class MasterAgentService:
    async def stream_message(self, ...):
        async for chunk in stream_message_v32(...):
            yield chunk
```

### **Step 4: í…ŒìŠ¤íŠ¸ ì‹¤í–‰**
```bash
python tests/test_v32_refactor.py
# ì˜ˆìƒ: âœ… ALL TESTS PASSED (6/6)
```

### **Step 5: ë°±ì—”ë“œ ì¬ì‹œì‘ ë° ëª¨ë‹ˆí„°ë§**
```bash
uvicorn app.main:app --host 0.0.0.0 --port 8002
```

---

**ì‘ì„±ì:** AI Assistant  
**ê²€í† ì:** í˜•ë‹˜ (ì‚¬ìš©ì)  
**ë²„ì „:** v3.2 (Risk Audit)  
**ìƒíƒœ:** âš ï¸ **Critical ì¡°ì¹˜ 5ê±´ ëŒ€ê¸°, High ì¡°ì¹˜ 3ê±´ ëŒ€ê¸°**  
**ì•ˆì „ ì˜ì—­:** âœ… **v3.2 ë¦¬íŒ©í† ë§ íŒŒì¼ (ì™„ì „ ê²©ë¦¬ ì™„ë£Œ)**  

---

**END OF REPORT**
